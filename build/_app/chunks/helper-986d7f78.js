import{C as t,Z as e,_ as s}from"./vendor-78501628.js";const n=t(null),a=t({}),i=t(null),o=t(null),l=t(null);function r(s,n){const a=t(n),{subscribe:i,set:o}=a,l="undefined"!=typeof localStorage?localStorage.getItem(s):null;function r(t,e){"undefined"!=typeof localStorage&&localStorage.setItem(t,JSON.stringify(e))}return l&&o(JSON.parse(l)),{set(t){r(s,t),o(t)},update(t){const n=t(e(a));r(s,n),o(n)},subscribe:i}}const h=r("consent",null),u=r("name",null),d=r("instances",[]),c=r("instancesUpdatedAt",null),f=r("SUBs",[]);r("SUBsCID",null);const g=r("SUBcache",[]);r("SUBcacheCID",null),r("SUBsUpdatedAt",null),r("SUBcacheUpdatedAt",null);const m=r("SUBsRefreshedAt",null),p=r("playlists",[]);r("settings",null);const v=async t=>{let e=[],s=await fetch("https://api.invidious.io/instances.json?pretty=0");return(await s.json()).forEach((s=>{var n,a,i,o,l;const r=null==(i=null==(a=null==(n=s[1])?void 0:n.stats)?void 0:a.software)?void 0:i.version.split("-")[0];if(r){if(new Date(r.replaceAll(".","-"))>new Date("2021-04-30")){const n=null==(l=null==(o=s[1])?void 0:o.stats)?void 0:l.metadata,a=s[0],{flag:i,uri:h}=s[1];t&&t.findIndex((t=>t[0]===a)),e=[...e,[a,{name:a,failedRequests:t?t[index].failedRequests:0,lastFailedRequest:t?t[index].lastFailedRequest:(new Date).getTime(),enabled:!t||t[index].enabled,data:{flag:i,uri:"/"!==h[h.length-1]?`${h}/`:h,metadata:n,version:r},refreshedAt:(new Date).getTime()}]]}}})),e},w=t=>{if(!t||t.length<1)return"oops something went wrong";let e=[];for(let s of t)s[1].enabled&&s[1].failedRequests<11&&e.push(s[0]);return e.length?e[Math.floor(Math.random()*e.length)]:"no valid instances"},$=t=>Math.floor(t/1e3)<1e3?`${(t/1e3).toFixed(2)}K`:Math.floor(t/1e6)<1e3?`${(t/1e6).toFixed(2)}M`:Math.floor(t/1e9)<1e3?`${(t/1e9).toFixed(2)}G`:t,b=t=>{let e=t/60,s=Math.floor(e),n=Math.round(60*(e-s));return n=n<10?`0${n}`:n,`${s}:${n}`},M=t=>{const e=Math.floor((new Date).getTime()/1e3)-t,s=3600,n=86400,a=30*n,i=365*n;let o;return e<30?o="just then":e<60?o=`${e} seconds ago`:e<120?o="$a minute ago":e<s?o=`${Math.floor(e/60)} minutes ago`:1==Math.floor(e/s)?o="1 hour ago":e<2*n?o=`${Math.floor(e/s)} hours ago`:e<5184e3?o=`${Math.floor(e/n)} days ago`:e<i||e<2*i?o=`${Math.floor(e/a)} months ago`:e<100*i&&(o=`${Math.floor(e/i)} years ago`),o},S=(t,e)=>{const s=e[e.findIndex((t=>100==t.width||88==t.width))].url.split("/")[4];return s?`https://${t}/ggpht/ytc/${s}`:""},x=(t,e,s)=>"dev"===s?console.log(t,e):"",y=t=>new Promise((e=>setTimeout(e,t))),A=t=>/^([A-Za-z0-9_\-]{11})$/.test(t),U=t=>/^([A-Za-z0-9_\-]{24})$/.test(t),q=t=>/^([A-Za-z0-9_\-]{34})$/.test(t);class D extends s.exports.EventEmitter{constructor(t,e){super(),this.instance=t,this.url=e,this.controller=void 0,this.signal=void 0,this.failedCount=0,this.running=!1,this.what}abort(){this.controller&&(this.controller.abort(),this.signal=void 0,this.controller=void 0),this.running=!1}async go(){if(this.running=!0,!this.instance)return this.abort();if("no valid instances"===this.instance||"oops something went wrong"===this.instance)return this.failedCount++,this.emit("err",this.instance),this.abort();if(void 0!==this.controller)return this.abort();this.controller=new AbortController,this.signal=this.controller.signal;try{this.emit("start",this.url);const t=setTimeout((()=>this.abort()),5e3),e=await fetch(`https://${this.instance}/api/v1${this.url}`,{signal:this.signal}),s=await e.json();return clearTimeout(t),this.signal=void 0,this.controller=void 0,this.running=!1,this.emit("ok",s),s}catch(t){return this.failedCount++,this.signal=void 0,this.controller=void 0,this.running=!1,this.emit("err",t),t}}}const R=(t,e)=>{const s=t.findIndex((t=>t[0]===e));return!(s<0)&&(t[s][1].failedRequests++,t[s][1].lastFailedRequest=(new Date).getTime(),t)};export{D as F,f as S,l as a,o as b,w as c,a as d,c as e,n as f,h as g,v as h,d as i,m as j,g as k,x as l,b as m,u as n,M as o,i as p,$ as q,p as r,y as s,S as t,R as u,q as v,U as w,A as x};
//# sourceMappingURL=helper-986d7f78.js.map
