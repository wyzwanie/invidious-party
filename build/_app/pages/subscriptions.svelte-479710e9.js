var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,s,o)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o;import{S as l,i as c,s as i,e as h,t as u,c as d,a as p,g as f,d as g,b as m,J as v,f as b,D as $,h as w,l as y,F as I,j,m as E,o as O,v as x,r as P,w as V,k as S,n as k,u as D,N,B as T,a0 as M,O as q}from"../chunks/vendor-78501628.js";import{S as C,i as A,j as B,k as R,f as U}from"../chunks/helper-986d7f78.js";import{V as z}from"../chunks/Videos-203bb769.js";import"../chunks/ImageLoader-7c2b3bfa.js";function F(e){let t,s,o,a,r,n,l,c,i=Math.floor(e[0]*e[1]/100)+"";return{c(){t=h("div"),s=h("div"),o=h("span"),a=u("Processing "),r=h("b"),n=u(i),l=u(" / "),c=u(e[1]),this.h()},l(h){t=d(h,"DIV",{class:!0});var u=p(t);s=d(u,"DIV",{class:!0,style:!0});var m=p(s);o=d(m,"SPAN",{class:!0});var v=p(o);a=f(v,"Processing "),r=d(v,"B",{class:!0});var b=p(r);n=f(b,i),l=f(b," / "),c=f(b,e[1]),b.forEach(g),v.forEach(g),m.forEach(g),u.forEach(g),this.h()},h(){m(r,"class","value"),m(o,"class","label svelte-9q8vfv"),m(s,"class","progress svelte-9q8vfv"),v(s,"width",e[0]+"%"),m(t,"class","progress-bar container svelte-9q8vfv")},m(e,i){b(e,t,i),$(t,s),$(s,o),$(o,a),$(o,r),$(r,n),$(r,l),$(r,c)},p(e,t){3&t&&i!==(i=Math.floor(e[0]*e[1]/100)+"")&&w(n,i),2&t&&w(c,e[1]),1&t&&v(s,"width",e[0]+"%")},d(e){e&&g(t)}}}function J(e){let t,s=e[0]<100&&F(e);return{c(){s&&s.c(),t=y()},l(e){s&&s.l(e),t=y()},m(e,o){s&&s.m(e,o),b(e,t,o)},p(e,[o]){e[0]<100?s?s.p(e,o):(s=F(e),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:I,o:I,d(e){s&&s.d(e),e&&g(t)}}}function L(e,t,s){let{progress:o}=t,{total:a}=t;return e.$$set=e=>{"progress"in e&&s(0,o=e.progress),"total"in e&&s(1,a=e.total)},[o,a]}class Y extends l{constructor(e){super(),c(this,e,L,J,i,{progress:0,total:1})}}function G(e){let t,s;return t=new z({props:{chosen:e[2],videos:e[1]}}),{c(){j(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,o){O(t,e,o),s=!0},p(e,s){const o={};4&s&&(o.chosen=e[2]),2&s&&(o.videos=e[1]),t.$set(o)},i(e){s||(x(t.$$.fragment,e),s=!0)},o(e){P(t.$$.fragment,e),s=!1},d(e){V(t,e)}}}function H(e){let t,s,o,a,r,n;o=new Y({props:{total:e[3].length,progress:e[0].length/e[3].length*100}});let l=e[1].length&&G(e);return{c(){t=h("div"),s=S(),j(o.$$.fragment),a=S(),l&&l.c(),r=y()},l(e){t=d(e,"DIV",{}),p(t).forEach(g),s=k(e),E(o.$$.fragment,e),a=k(e),l&&l.l(e),r=y()},m(e,c){b(e,t,c),b(e,s,c),O(o,e,c),b(e,a,c),l&&l.m(e,c),b(e,r,c),n=!0},p(e,[t]){const s={};1&t&&(s.progress=e[0].length/e[3].length*100),o.$set(s),e[1].length?l?(l.p(e,t),2&t&&x(l,1)):(l=G(e),l.c(),x(l,1),l.m(r.parentNode,r)):l&&(T(),P(l,1,1,(()=>{l=null})),D())},i(e){n||(x(o.$$.fragment,e),x(l),n=!0)},o(e){P(o.$$.fragment,e),P(l),n=!1},d(e){e&&g(t),e&&g(s),V(o,e),e&&g(a),l&&l.d(e),e&&g(r)}}}function K(e,l,c){let i,h,u,d,p;N(e,C,(e=>c(13,i=e))),N(e,A,(e=>c(14,h=e))),N(e,B,(e=>c(15,u=e))),N(e,R,(e=>c(16,d=e))),N(e,U,(e=>c(2,p=e)));let f=i;const g=new M(30,100);let m,v=[],b=[],$=[],w=[],y=[],I=!1;let j=(e=>{const t={};return e.forEach((e=>t[e]=[0,0])),t})(h.map((e=>e[1].enabled?e[0]:"")));const E=e=>{const t=[];Object.keys(e).forEach((s=>{const o=e[s][0]+e[s][1];o>0&&e[s][1],o>0?e[s][0]<10&&e[s][1]>0&&s&&t.push(s):t.push(s)}));return t[Math.floor(Math.random()*t.length)]},O=e=>{q(B,u=(new Date).getTime(),u);let l=e.map((e=>{return l=((e,t)=>{for(var s in t||(t={}))a.call(t,s)&&n(e,s,t[s]);if(o)for(var s of o(t))r.call(t,s)&&n(e,s,t[s]);return e})({},e),c={latestVideos:e.latestVideos.map((e=>({title:e.title,videoId:e.videoId,authorId:e.authorId,author:e.author,viewCount:e.viewCount,published:e.published,publishedText:e.publishedText,isUpcoming:e.isUpcoming,lengthSeconds:e.lengthSeconds,liveNow:e.liveNow})))},t(l,s(c));var l,c})),i=[];l.forEach((e=>{e.latestVideos.forEach(((e,t)=>{t<5&&i.push(e)}))})),c(1,y=i.sort(((e,t)=>t.published-e.published))),q(R,d=y,d)},x=async(e,t)=>{c(4,v=[...e]),m=[];for(let s of v){const e=Symbol(),o=E(t);m.push(g.wait(e,-1).then((async()=>{try{const t=new AbortController,a=setTimeout((()=>t.abort()),3e3);0;const r=await fetch(`https://${o}/api/v1/channels/${s}?fields=authorId,author,latestVideos`,{signal:t.signal}),n=await r.json();if(clearTimeout(a),n.authorId){c(4,v=v.filter((e=>e!==n.authorId))),c(7,j[o][1]++,j);w.findIndex((e=>e.authorId===n.authorId))>-1||(c(0,w=[...w,n]),O(w))}}catch(t){console.log("err",t),c(7,j[o][0]++,j),c(5,b=[...b,s])}finally{g.end(e)}})))}return await Promise.all(m),c(6,I=!0)};let P=0;return x(f,j),e.$$.update=()=>{497&e.$$.dirty&&I&&(c(8,P++,P),c(6,I=!1),c(5,b=b.filter((e=>$.findIndex((t=>t===e))<0))),console.log("--- nextRound ---"),console.log("result",w),console.log("Youtube",f),console.log("counter",P),console.log("ynstancezStatus",j),console.log("--- END nextRound ---"),v.length>0&&P<5&&x(v,j))},[w,y,p,f,v,b,I,j,P]}export default class extends l{constructor(e){super(),c(this,e,K,H,i,{})}}
//# sourceMappingURL=subscriptions.svelte-479710e9.js.map
